<!DOCTYPE html>
<head>
	<meta charset="utf-8">

	<title>Joseph Huynh | Weather App</title>
	<!-- font -->
	<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

	<!-- icons -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

	<!-- style -->		
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="css/weatherApp.css">

	<!-- Weather API -->
	<script type="text/javascript">
		var tempC, tempF, condition, city, country, lat, long, windAngle, windMetric, windImp, pressure, humidity;
		var system = "metric";

		function getCardinalDirection(degrees){
			var directions = ["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N"];
			return(directions[Math.round(degrees/22.5)+1]);
		}

		function printWeather(){
			if (condition==="Clear"){

			}

			if (system==="metric"){
				$("#temp").html(tempC);
				$("#degrees").html("°C");
				$("#speed").html(windMetric);
				$("#unit").html(" km/h");
			} else {
				$("#temp").html(tempF);
				$("#degrees").html("°F");
				$("#speed").html(windImp);
				$("#unit").html(" mph")
			}
			$("#cardinal").html(getCardinalDirection(windAngle));
			$("#humidity").html(humidity+"%");
			$("#pressure").html(pressure+" hPa");
		}

		function getLocation() {
			$.getJSON("http://ip-api.com/json", function(res){
				city = res.city;
				country = res.countryCode;
				lat = parseFloat(res.lat);
				long = parseFloat(res.lon);
				getWeather();
				$("#city").html(city);
				$("#country").html(country);
			});
		}

		function getWeather() {
			var url="http://api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+long+"&units=metric&APPID=de173eabdfc949d78ec193b50b80e5dd";			
			$.getJSON(url, function(res){
				condition = res.weather.main;
				tempC = Math.round(res.main.temp);
				tempF = Math.round(parseFloat(tempC)*(9/5)+32);
				windMetric = Math.round(res.wind.speed*18/5);	// Convert m/s to km/h
				windImp = parseFloat(res.wind.speed)/0.44704;
				windAngle = res.wind.deg;
				humidity = res.main.humidity;
				pressure = res.main.pressure;
				printWeather();
			});
		}

		$(document).ready(function() {
			getLocation();			
		});

	</script>
	
</head>

<body>
	<h1>Weather App</h1>
	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12"><span id="city"></span>, <span id="country"></span></div>
		</div>
		<div class="row">
			<div class="col-xs-4 right">
				<ul>
					<li>Temperature:</li>
					<li>Wind:</li>
					<li>Humidity:</li>
					<li>Pressure:</li>
				</ul>
			</div>

			<div class="col-xs-4">
				<ul style="list-style-type:none">
					<li><span id="temp"></span><span id="degrees"></span></li>
					<li><span id="cardinal"></span> <span id="speed"></span><span id="unit"></span></li>
					<li><span id="humidity"></span></li>
					<li><span id="pressure"></span></li>
				</ul>
			</div>

			<div class="col-xs-4">
				<div class="fa fa-5x pull-left" id="icon"><i class="fa fa-sun-o" aria-hidden="true"></i></div>
			</div>
		</div>
	</div>
</body>